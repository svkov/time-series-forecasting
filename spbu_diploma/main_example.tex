% ОБЯЗАТЕЛЬНО ИМЕННО ТАКОЙ documentclass!
% (Основной кегль = 14pt, поэтому необходим extsizes)
% Формат, разумеется, А4
% article потому что стандарт не подразумевает разделов
% Глава = section, Параграф = subsection
% (понятия "глава" и "параграф" из стандарта)
\documentclass[a4paper,article,14pt]{extarticle}

% Подключаем главный пакет со всем необходимым
\usepackage{spbudiploma}

% Пакеты по желанию (самые распространенные)
% Хитрые мат. символы
\usepackage{euscript}
% Таблицы
\usepackage{longtable}
\usepackage{makecell}
% Картинки (можно встявлять даже pdf)
\usepackage[pdftex]{graphicx}

\usepackage{amsthm,amssymb, amsmath}
\usepackage{textcomp}
\usepackage{amsmath}
\usepackage{comment}


\begin{document}

% Титульник в файле titlepage.tex
\input{titlepage_example.tex}

% Содержание
\tableofcontents
\pagebreak
\specialsection{Введение}
\input{../reports/diploma.tex}

\specialsection{Введение}

Прогнозирование временных рядов - одна из главных задач в экономике и финансах.
Хотя эта задача достаточно изучена для определенного класса временных рядов, остаются нерешенные проблемы.
Например, прогнозирование цен биржевых торгов.
\par
Прогнозирование биржевых цен позволяет крупным компаниям принимать стратегические решения, а частным трейдерам совершать выгодные сделки.
Цель этой работы - показать эффективность алгоритмов машинного обучения в вопросе прогнозирования цен биржевых торгов.
Чтобы показать эффективность алгоритмов, были использованы исторические данные, предоставляемые Yahoo Finance ~\cite{yahoo}, по нескольким финансовым инструментам.

\specialsection{Постановка задачи}

Даны временные ряды
\begin{equation}
    {X_{i} = \{x_{i,t}, t=\overline{1,k}\},\quad i=\overline{1,m}},\label{eq:equation}
\end{equation}
где $m$~--- общее количество рядов, а размер всех рядов совпадает и равен $k$.
Цель~--- предсказать значение всех рядов с лагом $n$.
Для этого требуется построить такую модель $A(X_i)$, что
\begin{equation}
    A(X_i)=x_{i, k+n}.\label{eq:equation2}
\end{equation}


\section{Обзор методов}

Для предсказания временных рядов использовались модели ARIMA (Autoregressive Integrated Moving Averate), VAR (Vector Autoregressive model), Wavelet, Fourier Extrapolation и Stacking.
Каждая из моделей сравнивалась с "наивной" моделью, которая предсказывала последнее известное значение на весь горизонт прогнозирования.

\par
Ниже приводится краткий обзор моделей:

1.
ARIMA~\cite{arima} - Модель ARIMA является классическим методом эконометрики для прогнозирования временных рядов.
Применение ARIMA для прогнозирования биржевых цен уже рассматривалось ранее~\cite{my_arima_article}.

\textbf{TODO: написать формулы.}

2.
VAR~\cite{var} - Модель VAR позволяет находить линейные зависимости между компонентами многомерных временных рядов.

\textbf{TODO: написать формулы и найти куда сослаться}

3.
Wavelet~\cite{wavelet} - В основе модели лежит дискретное вейвлет преобразование.
Исходный ряд раскладывается на $k$ рядов, каждый из которых предсказывается по отдельности при помощи ARIMA, после чего выполняется обратное преобразование.
В качестве вейвлет-функций используются койфлеты, так как показали лучший результат.

\textbf{TODO: написать формулы и источники}


\section{Оценка качества моделей}

Оценка качества моделей производилась методом кросс-валидации для временных рядов:

1.
Выборка делится на тренировочную и тестовую.

2.
Исходные ряды прогнозируются на $n$ точек вперед.

3.
Считаем целевую метрику, сравнивая предсказание с фактическими ценами и сохраняем.

4.
Первая точка из тестовой выборки перемещается в тренировочную

5.
Повторяем п. 2 - п. 4 до тех пор, пока в тестовой выборке будет оставаться больше $n$ точек.

6.
Посчитать средневзвешенное значение для всего полученного массива метрик.

В предложенном алгоритме стоит пояснить п. 3.
Можно считать близость двух векторов (вектор предсказаний и вектор фактических цен), либо можно считать близость предсказания в последней точке прогноза.
В первом случае мы оценим модель на то, насколько точно она прогнозирует общую картину изменения цен (скачки цен внутри периода), при этом мы пренебрегаем тем, что цена в конце периода может быть важнее, чем остальные цены.
Во втором случае мы оценим насколько точно модель прогнозирует цену по заданному горизонту, игнорируя общую картину.
Есть третий подход, который является компромисом.
Можно для каждого дня прогноза оценивать близость с фактической ценой в этот день.
Тогда для каждого прогнозного дня будет свое значение метрики.

В этой работе будем использовать второй и третий подход, так как их проще интерпретировать.

В качестве метрики будем использовать: Mean absolute error (MAE), mean absolute percentage error (MAPE), root mean squared error (RMSE).

\section{Воспроизводимость вычислений}

Для того, чтобы полученные результаты были достоверными и воспроизводимыми, а также чтобы полученные модели можно было использовать как фреймворк для произвольных данных в будущем, был построен конвейер (pipeline) для обработки данных.
Для реализации конвейера использовался инструмент snakemake~\cite{snakemake}.
Snakemake позволяет определять "правила" (rules) для обработки данных.
Каждое правило может иметь входные и выходные файлы.
Правило должно генерировать из входного файла выходной.
Если входной файл не существует, то ищется другое правило, которое генерирует этот файл.
Таким образом, получается ациклический граф работ, при помощи которого snakemake планирует и исполняет все необходимые работы для того, чтобы получить результат.

В представленном исследовании граф работ~\cite{graph_dag} выглядит так:
\begin{figure}[ht]
\begin{center}
\scalebox{0.4}{
   \includegraphics{../dag.svg}
}

\caption{
\label{graph_dag}
     Ациклический граф работ.}
\end {center}
\end {figure}

1.
Загружаем данные

2.
Преобразуем исходные данные в удобный формат.

3.
Используем модели для построения прогнозов по заданным датам и генерации тестовой выборки.

4.
Полученные данные используются для генерации графиков и подсчета метрик.

5.
Генерируем код LaTeX для вставки графиков и таблиц с результатами

\section{Эксперимент}

Были взяты данные с Yahoo Finance~\cite{yahoo}.

\input{../reports/tickers.tex}


Для каждого временного ряда применялась каждая из моделей.
Модель VAR применялась сразу для всех временных рядов.
Сравнение результатов происходило по метрикам:

MAE (Mean absolute error):
\begin{equation}
    MAE = \sum_{i=1}^{n} \frac{|y_i - x_i|}{n}\label{eq:mae}
\end{equation}

MAPE (Mean absolute percentage error):

\begin{equation}
    MAPE = \frac{1}{n} \sum_{i=1}^{n} \left| \frac{y_i - x_i}{y_i} \right|\label{eq:mape}
\end{equation}

RMSE (Root mean square error)

\begin{equation}
    RMSE = \sqrt{\sum_{i=1}^{n} \frac{(x_i - y_i) ^ 2}{n}}\label{eq:rmse}
\end{equation}

Результаты можно наблюдать в таблице~\ref{result_table}.
\input{../reports/result_table.tex}
\specialsection{Выводы}

Таким образом, использованные методы прогнозирования дают прогноз значительно лучше, чем наивное предсказание.
Учитывая высокую волатильность рынков, этот результат является значимым.
Использованные подходы универсальны и их можно применять для предсказания любых других временных рядов, например, в задачах прогнозирования погоды, городских пробок и различных экономических показателей.
Полученные результаты можно улучшить, если преобразовать исходные ряды.

% Библиография в cpsconf стиле
% Аргумент {1} ниже включает переопределенный стиль с выравниванием слева
\begin{thebibliography}{1}
\bibitem{arima} Магнус Я. Р., Катышев П. К., Пересецкий А. А. Эконометрика. Начальный курс.. М.: Дело, 2004. 576 с.
\bibitem{var} Носко В.П. Эконометрика. Введение в регрессионный анализ временных рядов
\bibitem{snakemake} Köster, Johannes and Rahmann, Sven. “Snakemake - A scalable bioinformatics workflow engine”. Bioinformatics 2012.
\bibitem{wavelet} Wang, F.; Yu, Y.; Zhang, Z.; Li, J.; Zhen, Z.; Li, K. Wavelet Decomposition and Convolutional LSTM Networks Based Improved Deep Learning Model for Solar Irradiance Forecasting. Appl. Sci. 2018, 8, 1286.
\bibitem{yahoo} https://finance.yahoo.com/
\bibitem{my_arima_article} Ковалев С. С. "Прогнозирование средневзвешенной цены торгов нефтепродуктами на бирже классическими методами анализа временных рядов"
\end{thebibliography}
\end{document}